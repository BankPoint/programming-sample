-------------------------------------------------------------------------------------------
-- DO NOT EDIT THIS FILE
-- 
-- This will create a database named fullstacktest with the baseline schema
-- 
-- To apply this to your local SQL Server (or express) instance you can run the following
-- from the command line
--     sqlcmd.exe -E -i .\build\sql-migrations.sql
-- 
-------------------------------------------------------------------------------------------
use master
DECLARE @dbname nvarchar(128) = (SELECT 'bploans')
IF (NOT EXISTS (SELECT name FROM master.dbo.sysdatabases WHERE ('['+name+']' = @dbname OR name = @dbname)))
BEGIN

	PRINT 'Creating the bploans database'
	CREATE DATABASE bploans 
END
GO

use bploans
GO

IF ((select object_id from sys.tables where name = 'Loans') IS NULL)
BEGIN

    CREATE TABLE [dbo].[Branches] (
        [ID] int IDENTITY(1,1) NOT NULL,
        [BranchCode] [nvarchar](8) NOT NULL,
        [BranchDescription] [nvarchar](64) NOT NULL
    PRIMARY KEY CLUSTERED ([ID] ASC))
    
    CREATE TABLE [dbo].[Customers] (
        [ID] [int] IDENTITY(1,1) NOT NULL,
        [Name] [nvarchar](64) NOT NULL
    PRIMARY KEY CLUSTERED ([ID] ASC))

	CREATE TABLE [dbo].[Loans](
		[ID] [int] IDENTITY(1,1) NOT NULL,
		[LoanNumber] [nvarchar](64) NOT NULL,
		[LoanType] [int] NULL,
		[OriginationDate] [datetime] NULL,
		[OriginalLoanAmount] [money] NULL,
		[EffectiveDate] [datetime] NULL,
		[Principal] [money] NULL,
		[TotalLoanCommitment] [money] NULL,
		[InterestRate] [decimal](19, 5) NULL,
		[AccruedInterest] [money] NULL,
		[MaturityDate] [datetime] NULL,
		[Escrow] [money] NULL,
        [CustomerId] int NULL CONSTRAINT FK_Loans_Customers FOREIGN KEY REFERENCES Customers(ID),
        [BranchId] int NULL CONSTRAINT FK_Loans_Branches FOREIGN KEY REFERENCES Branches(ID)
	PRIMARY KEY CLUSTERED 
	(
		[ID] ASC
	))

    CREATE TABLE [dbo].[Collateral] (
        [ID] int IDENTITY(1,1) NOT NULL,
        [CollateralNumber] [nvarchar](8) NOT NULL,
        [Description] [nvarchar](128) NOT NULL,
        [LoanId] int NULL CONSTRAINT FK_Collateral_Loans FOREIGN KEY REFERENCES Loans(ID)
    PRIMARY KEY CLUSTERED ([ID] ASC))


END






